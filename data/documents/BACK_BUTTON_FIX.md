# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" ‚úÖ

**–î–∞—Ç–∞:** 2025-12-19
**–°—Ç–∞—Ç—É—Å:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

## –ü—Ä–æ–±–ª–µ–º–∞

–°–∏—Å—Ç–µ–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" Android (—Å—Ç—Ä–µ–ª–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏–ª–∏ –∂–µ—Å—Ç) –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –∫–∞–º–µ—Ä—ã. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–≥ –≤—ã–π—Ç–∏ —Å —ç–∫—Ä–∞–Ω–∞ –∫–∞–º–µ—Ä—ã, –Ω–∞–∂–∞–≤ —Å–∏—Å—Ç–µ–º–Ω—É—é –∫–Ω–æ–ø–∫—É –Ω–∞–∑–∞–¥.

### –°—Ü–µ–Ω–∞—Ä–∏–π –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

1. –û—Ç–∫—Ä—ã—Ç—å —ç–∫—Ä–∞–Ω –∫–∞–º–µ—Ä—ã
2. –ù–∞–∂–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—É—é –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" Android (—Å—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ –∏–ª–∏ –∂–µ—Å—Ç)
3. **–ù–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç** - —ç–∫—Ä–∞–Ω –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è

---

## –ü—Ä–∏—á–∏–Ω–∞

–í `PhotoCaptureFragment` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" Android —á–µ—Ä–µ–∑ `OnBackPressedDispatcher`.

**–ß—Ç–æ –±—ã–ª–æ:**
- –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞" –≤ UI —Ä–∞–±–æ—Ç–∞–ª–∞ (–≤—ã–∑—ã–≤–∞–ª–∞ `PhotoCaptureEvent.Cancel`)
- –ù–û —Å–∏—Å—Ç–µ–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" Android –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞—Å—å
- Fragment –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–ª —Å–æ–±—ã—Ç–∏–µ back press

---

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" —á–µ—Ä–µ–∑ `OnBackPressedCallback` –≤ `PhotoCaptureFragment.kt:156-167`.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è

#### 1. –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç

```kotlin
import androidx.activity.OnBackPressedCallback
```

#### 2. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `setupBackPressHandler()`

```kotlin
private fun setupBackPressHandler() {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" Android
    val callback = object : OnBackPressedCallback(true) {
        override fun handleOnBackPressed() {
            Log.d("PhotoCaptureFragment", "–°–∏—Å—Ç–µ–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ '–ù–∞–∑–∞–¥' –Ω–∞–∂–∞—Ç–∞")
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ Cancel –≤ ViewModel
            // Cancel –Ω–∞–≤–∏–≥–∏—Ä—É–µ—Ç –Ω–∞–∑–∞–¥ —á–µ—Ä–µ–∑ NavigateBack effect
            viewModel.handleEvent(PhotoCaptureEvent.Cancel)
        }
    }
    requireActivity().onBackPressedDispatcher.addCallback(viewLifecycleOwner, callback)
}
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –°–æ–∑–¥–∞—ë—Ç—Å—è `OnBackPressedCallback` —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º `true` (–±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –ø–µ—Ä–≤—ã–º)
2. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `handleOnBackPressed()`
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `PhotoCaptureEvent.Cancel` –≤ ViewModel
4. ViewModel –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `PhotoCaptureEffect.NavigateBack`
5. Fragment –≤—ã–∑—ã–≤–∞–µ—Ç `findNavController().navigateUp()`
6. –≠–∫—Ä–∞–Ω –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è

#### 3. –í—ã–∑–æ–≤ –≤ `onViewCreated()`

```kotlin
override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
    super.onViewCreated(view, savedInstanceState)

    viewModel.init(config, viewLifecycleOwner)

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
    setupBackPressHandler()  // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ

    setupViews()
    setupClickListeners()
    // ...
}
```

**–í–∞–∂–Ω–æ:**
- Callback –ø—Ä–∏–≤—è–∑–∞–Ω –∫ `viewLifecycleOwner` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏ View
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏
- –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç–µ

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–¥–∏–Ω—ã–π –ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏:** –°–∏—Å—Ç–µ–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –∏ –∫–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞" –≤ UI –≤—ã–∑—ã–≤–∞—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ event `PhotoCaptureEvent.Cancel`

‚úÖ **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å:** –õ–æ–≥–∏–∫–∞ –≤—ã—Ö–æ–¥–∞ —Å —ç–∫—Ä–∞–Ω–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (ViewModel)

‚úÖ **Lifecycle-aware:** Callback –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏ View

‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω –ª–æ–≥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞–∂–∞—Ç–∏–π

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Manual QA Checklist

- [x] –°–∏—Å—Ç–µ–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" Android –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω –∫–∞–º–µ—Ä—ã
- [x] –ñ–µ—Å—Ç "–ù–∞–∑–∞–¥" (—Å–≤–∞–π–ø —Å –ª–µ–≤–æ–≥–æ –∫—Ä–∞—è) –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω –∫–∞–º–µ—Ä—ã
- [x] –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞" –≤ UI —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ
- [x] –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏ —Å–∏—Å—Ç–µ–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ (callback —É–¥–∞–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

1. **–ë–∞–∑–æ–≤—ã–π —Ñ–ª–æ—É:**
   - –û—Ç–∫—Ä—ã—Ç—å –∫–∞–º–µ—Ä—É ‚Üí –Ω–∞–∂–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—É—é –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" ‚Üí —ç–∫—Ä–∞–Ω –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚úÖ

2. **–ñ–µ—Å—Ç "–ù–∞–∑–∞–¥":**
   - –û—Ç–∫—Ä—ã—Ç—å –∫–∞–º–µ—Ä—É ‚Üí —Å–≤–∞–π–ø —Å –ª–µ–≤–æ–≥–æ –∫—Ä–∞—è ‚Üí —ç–∫—Ä–∞–Ω –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚úÖ

3. **–ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞":**
   - –û—Ç–∫—Ä—ã—Ç—å –∫–∞–º–µ—Ä—É (–±–µ–∑ —Ñ–æ—Ç–æ) ‚Üí –Ω–∞–∂–∞—Ç—å "–û—Ç–º–µ–Ω–∞" ‚Üí —ç–∫—Ä–∞–Ω –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚úÖ

4. **–ü–æ—Å–ª–µ –≥–∞–ª–µ—Ä–µ–∏:**
   - –û—Ç–∫—Ä—ã—Ç—å –∫–∞–º–µ—Ä—É ‚Üí –≥–∞–ª–µ—Ä–µ—è ‚Üí –Ω–∞–∑–∞–¥ ‚Üí –Ω–∞–∂–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—É—é –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" ‚Üí —ç–∫—Ä–∞–Ω –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚úÖ

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### OnBackPressedCallback

`OnBackPressedCallback` - —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ Android:

- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** Callback —Å `enabled = true` –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç back press –ø–µ—Ä–≤—ã–º
- **Lifecycle-aware:** –ú–æ–∂–Ω–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å –∫ –ª—é–±–æ–º—É `LifecycleOwner`
- **–¶–µ–ø–æ—á–∫–∞:** –ï—Å–ª–∏ callback –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ, –æ–Ω–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –¥–∞–ª—å—à–µ
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:** –ü—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏ lifecycle callback —É–¥–∞–ª—è–µ—Ç—Å—è

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã)

‚ùå **Override `onBackPressed()` –≤ Activity** - –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, deprecated

‚ùå **KeyEvent.KEYCODE_BACK** - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∂–µ—Å—Ç–∞–º–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

‚úÖ **OnBackPressedCallback** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥

---

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ –ª–æ–≥–∞—Ö –ø–æ—è–≤–∏—Ç—Å—è:

```
D/PhotoCaptureFragment: –°–∏—Å—Ç–µ–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ '–ù–∞–∑–∞–¥' –Ω–∞–∂–∞—Ç–∞
```

–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–¥–∏—Ç—å —á—Ç–æ –∫–Ω–æ–ø–∫–∞ –±—ã–ª–∞ –Ω–∞–∂–∞—Ç–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞.

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞**! ‚úÖ

### –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:

- ‚úÖ –°–∏—Å—Ç–µ–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" Android —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ñ–µ—Å—Ç "–ù–∞–∑–∞–¥" –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ –ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã—Ö–æ–¥–∞ —Å —ç–∫—Ä–∞–Ω–∞ (—á–µ—Ä–µ–∑ Cancel event)
- ‚úÖ Lifecycle-aware —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–π—Ç–∏ —Å —ç–∫—Ä–∞–Ω–∞ –∫–∞–º–µ—Ä—ã –ª—é–±—ã–º —Å–ø–æ—Å–æ–±–æ–º!** üîô‚ú®
